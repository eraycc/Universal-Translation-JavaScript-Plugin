// ==UserScript==
// @name        Êô∫ËÉΩÁøªËØëÂä©Êâã
// @name:zh-CN  Êô∫ËÉΩÁøªËØëÂä©Êâã
// @name:zh-TW  Êô∫ËÉΩÁøªË≠ØÂä©Êâã
// @name:ar     Intelligent Translation Assistant
// @name:bg     Intelligent Translation Assistant
// @name:cs     Intelligent Translation Assistant
// @name:da     Intelligent Translation Assistant
// @name:de     Intelligent Translation Assistant
// @name:el     Intelligent Translation Assistant
// @name:en     Intelligent Translation Assistant
// @name:eo     Intelligent Translation Assistant
// @name:es     Intelligent Translation Assistant
// @name:es-419 Intelligent Translation Assistant
// @name:fi     Intelligent Translation Assistant
// @name:fr     Intelligent Translation Assistant
// @name:fr-CA  Intelligent Translation Assistant
// @name:he     Intelligent Translation Assistant
// @name:hr     Intelligent Translation Assistant
// @name:hu     Intelligent Translation Assistant
// @name:id     Intelligent Translation Assistant)
// @name:it     Intelligent Translation Assistant
// @name:ja     Intelligent Translation Assistant
// @name:ka     Intelligent Translation Assistant
// @name:ko     Intelligent Translation Assistant
// @name:nb     Intelligent Translation Assistant
// @name:nl     Intelligent Translation Assistant
// @name:pl     Intelligent Translation Assistant
// @name:pt-BR  Intelligent Translation Assistant
// @name:ro     Intelligent Translation Assistant
// @name:ru     Intelligent Translation Assistant
// @name:sv     Intelligent Translation Assistant
// @name:th     Intelligent Translation Assistant
// @name:tr     Intelligent Translation Assistant
// @name:uk     Intelligent Translation Assistant
// @name:ug     Intelligent Translation Assistant
// @name:vi     Intelligent Translation Assistant
// @namespace    http://tampermonkey.net/
// @version      1.2.1
// @description       ÂäüËÉΩÂº∫Â§ßÁöÑÁΩëÈ°µÁøªËØëÂ∑•ÂÖ∑ÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÔºåÂèØËá™ÂÆö‰πâÈÖçÁΩÆÔºåÁïåÈù¢Á≤æÁæéÔºåÊîØÊåÅÁßªÂä®Á´Ø
// @description:zh-CN ÂäüËÉΩÂº∫Â§ßÁöÑÁΩëÈ°µÁøªËØëÂ∑•ÂÖ∑ÔºåÊîØÊåÅÂ§öËØ≠Ë®ÄÔºåÂèØËá™ÂÆö‰πâÈÖçÁΩÆÔºåÁïåÈù¢Á≤æÁæéÔºåÊîØÊåÅÁßªÂä®Á´Ø
// @description:zh-TW ÂäüËÉΩÂº∑Â§ßÁöÑÁ∂≤È†ÅÁøªË≠ØÂ∑•ÂÖ∑ÔºåÊîØÊè¥Â§öË™ûË®ÄÔºåÂèØËá™Ë®ÇÈÖçÁΩÆÔºå‰ªãÈù¢Á≤æÁæéÔºåÊîØÊè¥Ë°åÂãïÁ´Ø
// @description:ar    ÿ£ÿØÿßÿ© ÿ™ÿ±ÿ¨ŸÖÿ© ŸàŸäÿ® ŸÇŸàŸäÿ©ÿå ÿ™ÿØÿπŸÖ ŸÑÿ∫ÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©ÿå ŸàŸäŸÖŸÉŸÜ ÿ™ÿÆÿµŸäÿµŸáÿßÿå ŸàŸÑŸáÿß Ÿàÿßÿ¨Ÿáÿ© ÿ¨ŸÖŸäŸÑÿ©ÿå Ÿàÿ™ÿØÿπŸÖ ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑŸÖÿ≠ŸÖŸàŸÑÿ©
// @description:bg    –ú–æ—â–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞ —É–µ–± –ø—Ä–µ–≤–æ–¥, –ø–æ–¥–¥—ä—Ä–∂–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –µ–∑–∏—Ü–∏, –º–æ–∂–µ –¥–∞ —Å–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞, –∏–º–∞ –∫—Ä–∞—Å–∏–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ø–æ–¥–¥—ä—Ä–∂–∞ –º–æ–±–∏–ª–Ω–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∏
// @description:cs    V√Ωkonn√Ω n√°stroj pro webov√Ω p≈ôeklad, podporuje v√≠ce jazyk≈Ø, lze jej p≈ôizp≈Øsobit, m√° kr√°sn√© rozhran√≠ a podporuje mobiln√≠ termin√°ly
// @description:da    Kraftfuldt webovers√¶ttelsesv√¶rkt√∏j, underst√∏tter flere sprog, kan tilpasses, har en flot brugerflade og underst√∏tter mobile terminaler
// @description:de    Leistungsstarkes Web-√úbersetzungstool, unterst√ºtzt mehrere Sprachen, kann angepasst werden, hat eine sch√∂ne Benutzeroberfl√§che und unterst√ºtzt mobile Endger√§te
// @description:el    ŒôœÉœáœÖœÅœå ŒµœÅŒ≥Œ±ŒªŒµŒØŒø ŒºŒµœÑŒ¨œÜœÅŒ±œÉŒ∑œÇ ŒπœÉœÑŒøœÉŒµŒªŒØŒ¥œâŒΩ, œÖœÄŒøœÉœÑŒ∑œÅŒØŒ∂ŒµŒπ œÄŒøŒªŒªŒ≠œÇ Œ≥ŒªœéœÉœÉŒµœÇ, ŒºœÄŒøœÅŒµŒØ ŒΩŒ± œÄœÅŒøœÉŒ±œÅŒºŒøœÉœÑŒµŒØ, Œ≠œáŒµŒπ œåŒºŒøœÅœÜŒø œÄŒµœÅŒπŒ≤Œ¨ŒªŒªŒøŒΩ ŒµœÅŒ≥Œ±œÉŒØŒ±œÇ Œ∫Œ±Œπ œÖœÄŒøœÉœÑŒ∑œÅŒØŒ∂ŒµŒπ Œ∫ŒπŒΩŒ∑œÑŒ¨ œÑŒµœÅŒºŒ±œÑŒπŒ∫Œ¨
// @description:eo    Potenca rettradukilo, subtenas plurajn lingvojn, povas esti personigita, havas belan interfacon, kaj subtenas porteblajn terminalojn
// @description:es    Potente herramienta de traducci√≥n web, admite varios idiomas, se puede personalizar, tiene una hermosa interfaz y es compatible con terminales m√≥viles.
// @description:fi    Tehokas verkkok√§√§nn√∂sty√∂kalu, tukee useita kieli√§, on muokattavissa, siin√§ on kaunis k√§ytt√∂liittym√§ ja se tukee mobiililaitteita
// @description:fr    Outil de traduction Web puissant, prend en charge plusieurs langues, peut √™tre personnalis√©, poss√®de une belle interface et prend en charge les terminaux mobiles
// @description:fr-CA Outil de traduction Web puissant, prend en charge plusieurs langues, peut √™tre personnalis√©, poss√®de une belle interface et prend en charge les terminaux mobiles
// @description:he    ◊õ◊ú◊ô ◊™◊®◊í◊ï◊ù ◊ê◊ô◊†◊ò◊®◊†◊ò ◊¢◊ï◊¶◊û◊™◊ô, ◊™◊ï◊û◊ö ◊ë◊©◊§◊ï◊™ ◊û◊®◊ï◊ë◊ï◊™, ◊†◊ô◊™◊ü ◊ú◊î◊™◊ê◊û◊î ◊ê◊ô◊©◊ô◊™, ◊ë◊¢◊ú ◊û◊û◊©◊ß ◊ô◊§◊î◊§◊î ◊ï◊™◊ï◊û◊ö ◊ë◊û◊°◊ï◊§◊ô◊ù ◊†◊ô◊ô◊ì◊ô◊ù
// @description:hr    Moƒáan alat za web prevoƒëenje, podr≈æava vi≈°e jezika, mo≈æe se prilagoditi, ima prekrasno suƒçelje i podr≈æava mobilne terminale
// @description:hu    Hat√©kony weblapford√≠t√≥ eszk√∂z, t√∂bbnyelv≈± t√°mogat√°ssal, testreszabhat√≥ be√°ll√≠t√°sokkal, kifinomult fel√ºlettel √©s mobil eszk√∂z√∂kre optimaliz√°lva.
// @description:id    Alat penerjemah situs web yang andal, mendukung multi-bahasa, dapat dikonfigurasi sesuai kebutuhan, antarmuka elegan, dan kompatibel dengan perangkat seluler.
// @description:it    Uno strumento di traduzione web potente, supporta pi√π lingue, configurabile, con interfaccia raffinata e compatibile con dispositivi mobili.
// @description:ja    Âº∑Âäõ„Å™„Ç¶„Çß„ÉñÁøªË®≥„ÉÑ„Éº„É´„ÄÇÂ§öË®ÄË™ûÂØæÂøú„ÄÅ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ÂèØËÉΩ„Å™Ë®≠ÂÆö„ÄÅÊ¥óÁ∑¥„Åï„Çå„Åü„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„ÄÅ„É¢„Éê„Ç§„É´ÂØæÂøú„ÄÇ
// @description:ka    ·Éõ·É´·Éö·Éê·Éï·É†·Éò ·Éï·Éî·Éë-·Éí·Éï·Éî·É†·Éì·Éò·É° ·Éó·Éê·É†·Éí·Éõ·Éú·Éò·É° ·Éò·Éú·É°·É¢·É†·É£·Éõ·Éî·Éú·É¢·Éò, ·Éõ·É†·Éê·Éï·Éê·Éö·Éî·Éú·Éù·Éï·Éê·Éú·Éò ·Éõ·ÉÆ·Éê·É†·Éì·Éê·É≠·Éî·É†·Éò·Éó, ·Éô·Éù·Éú·É§·Éò·Éí·É£·É†·Éò·É†·Éî·Éë·Éê·Éì·Éò ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò·Éó, ·Éì·Éê·ÉÆ·Éï·Éî·É¨·Éò·Éö·Éò ·Éò·Éú·É¢·Éî·É†·É§·Éî·Éò·É°·Éò·Éó ·Éì·Éê ·Éõ·Éù·Éë·Éò·Éö·É£·É†·Éò ·Éõ·Éù·É¨·Éß·Éù·Éë·Éò·Éö·Éù·Éë·Éî·Éë·Éò·É°·Éó·Éï·Éò·É° ·Éõ·ÉÆ·Éê·É†·Éì·Éê·É≠·Éî·É†·Éò·Éó.
// @description:ko    Í∞ïÎ†•Ìïú ÏõπÌéòÏù¥ÏßÄ Î≤àÏó≠ ÎèÑÍµ¨, Îã§Íµ≠Ïñ¥ ÏßÄÏõê, ÏÇ¨Ïö©Ïûê Ï†ïÏùò ÏÑ§Ï†ï Í∞ÄÎä•, ÏÑ∏Î†®Îêú Ïù∏ÌÑ∞ÌéòÏù¥Ïä§, Î™®Î∞îÏùº ÏßÄÏõê.
// @description:nb    Et kraftig nettstedoversettelsesverkt√∏y som st√∏tter flere spr√•k, kan tilpasses, har et elegant grensesnitt og er egnet for mobilbruk.
// @description:nl    Een krachtige webvertaaltool, ondersteunt meerdere talen, is aanpasbaar, heeft een verfijnde interface en ondersteuning voor mobiele apparaten.
// @description:pl    Potƒô≈ºne narzƒôdzie do t≈Çumaczenia stron internetowych, obs≈ÇugujƒÖce wiele jƒôzyk√≥w, konfigurowalne, z eleganckim interfejsem i obs≈ÇugƒÖ urzƒÖdze≈Ñ mobilnych.
// @description:pt-BR Uma ferramenta de tradu√ß√£o de p√°ginas web poderosa, suporte multil√≠ngue, configur√°vel, interface refinada e compat√≠vel com dispositivos m√≥veis.
// @description:ro    Un instrument puternic de traducere a paginilor web, suportƒÉ mai multe limbi, configurabil, cu interfa»õƒÉ rafinatƒÉ »ôi suport pentru dispozitive mobile.
// @description:ru    –ú–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —è–∑—ã–∫–æ–≤, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –∏–∑—ã—Å–∫–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–∞–±–æ—Ç—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.
// @description:sv    Ett kraftfullt √∂vers√§ttningsverktyg f√∂r webbsidor, st√∂der flerspr√•kighet, anpassningsbara inst√§llningar, sofistikerat gr√§nssnitt och mobilkompatibilitet.
// @description:th    ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏õ‡∏•‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏à‡∏≠‡∏±‡∏ô‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á ‡∏°‡∏µ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ü‡∏ã‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
// @description:tr    G√º√ßl√º bir web sayfasƒ± √ßeviri aracƒ±, √ßok dilli destek, √∂zelle≈ütirilebilir yapƒ±landƒ±rma, ≈üƒ±k aray√ºz ve mobil cihaz desteƒüi.
// @description:uk    –ü–æ—Ç—É–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞–¥—É –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–æ–∫, –ø—ñ–¥—Ç—Ä–∏–º—É—î –±–∞–≥–∞—Ç–æ–º–æ–≤–Ω—ñ—Å—Ç—å, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –≤–∏—Ç–æ–Ω—á–µ–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —ñ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ –º–æ–±—ñ–ª—å–Ω–∏–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏.
// @description:ug    ŸÉ€à⁄ÜŸÑ€àŸÉ ÿ™Ÿàÿ±ÿ®€ïÿ™ ÿ™€ïÿ±ÿ¨ŸâŸÖ€ï ŸÇŸàÿ±ÿßŸÑŸâÿå ŸÉ€ÜŸæ ÿ™ŸâŸÑŸÜŸâ ŸÇŸàŸÑŸÑÿßŸäÿØ€áÿå ÿ≥€ïŸæŸÑŸâŸÖ€ï ÿ™€ï⁄≠ÿ¥ŸâŸÉŸâÿå ÿ≤ŸâŸÜ⁄æÿßÿ± ÿ¶€êÿ∫Ÿâÿ≤ ŸÉ€Üÿ±€àŸÜ€àÿ¥Ÿâ €ã€ï ÿ™€ï€ã€ïŸÉŸÉ€àÿ± ÿ¶€àÿ≥ŸÉ€àŸÜŸâÿ≥ŸâŸÜŸâ ŸÇŸàŸÑŸÑÿßŸäÿØ€á.
// @description:vi    C√¥ng c·ª• d·ªãch trang web m·∫°nh m·∫Ω, h·ªó tr·ª£ ƒëa ng√¥n ng·ªØ, c√≥ th·ªÉ t√πy ch·ªânh c·∫•u h√¨nh, giao di·ªán tinh t·∫ø v√† h·ªó tr·ª£ thi·∫øt b·ªã di ƒë·ªông.
// @author       Eray
// @icon      data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABvBAMAAAApjDIIAAAA82VYSWZNTQAqAAAACAAFAQAAAwAAAAEAcQAAAQEAAwAAAAEAbwAAATEAAgAAABcAAABKh2kABAAAAAEAAABhARIABAAAAAEAAAAAAAAAAEFuZHJvaWQgUEQyMTE4X0FfOS4zLjEAAASQAwACAAAAFAAAAJeSkQACAAAABDc4MgCQEQACAAAABwAAAKuSCAAEAAAAAQAAAAAAAAAAMjAyNTowODoxOSAyMjoxMjoxMAArMDg6MDAAAAMBAAADAAAAAQBxAAABMQACAAAAFwAAANwBAQADAAAAAQBvAAAAAAAAQW5kcm9pZCBQRDIxMThfQV85LjMuMQA+yDmGAAAAFVBMVEVuY8VtacxwXbxub9P///+3s+Pp6Pd/O4+7AAAGzklEQVRYw41Yy3IcNwwEqEhnTljKmTUp57zjjXyOotGeV9bj7NiK/v8TghdJkDu7MWVLpSr1NtBoYMCB/eZJyz6lNC1p6k+cECGCnC3UsoXDSGeCGAlKZwOZ+EvRE31fOjTSP2Ld5Ez8Py3MOXlUFMoI/AW4GS1hhDPxmfhL2JRSGClUPEUSbL/o6dVhjPBSnqrRGU5RaMiShUUQzniCpGqIrgTrsmxxRqvJKeciVdE0CZJ8WYRTNRqRzKecPQyNEyFWIJy3T6pQrFlKyFoUGMSxM20oW5Q5l2cqJdGAhSwqr6IjniKXvTm2GaBA2bEADTVyLnvn2JYmc6pjIbZWgb6WRjk4Vv61cmxyCmVxbBWWfUflVJHsZOikXfbbjp1UG0ZgAYJPcl9rsiRHycGarltVqcIOjhVdyT0IXtcMPadkuRTvFbNymtolrG2BtjxTETalvrNinHoH0Amdtsk7dmmORW0S6NChIltvDY6NpZ2bAwiWGdpxFmia7l5fF+GTaalTNnqFLE+zgIwPETa9fXw8mdtbY6IHwtCXOn6m6WVdnzjBWJVtnITKNVrXlVpMQVqs3nRKmIMh09JGgYWrSJs9XEr0aQbzbRuxTVeNtozY2IvTOBcGE+Ptaz2E/Lf9ths42ULAht2b57581LOua/vl4+gwQY5VZbFHHxFtn103RjRicLVMf55DHl1fZmEsjtfpM13gHAg5z6VO2ekip1WDCZlzVs5kEr19DOd9XQ/8c4e9rkIqo2BSy6ZxbFMQD/wzOliWLBnJT0uxDz841ROlOfGlBNrmFoTqBBnMfVvGyaYdIxEHbSRL42QrDGMEpcHeRdbRPnxm4ZQUhxkrRr9e10fourKlyZxcl/00kEp/3ZBAWBaKOkk4yyBIHbEVFXkcaI+8tEoOWc5BOJnUQbkU0pggaSL68ayxzp6zrQW3VH7GRU3T4UwcaZbs3FdI0/t6eGLON0uzQQP7nT5gFm1PRyyl9w+X892nGQqlxMp5qmfcHInTbxQl6XPNTYLQpal9bfXUseUfJAx5gvhW06R5chRpZzDSeWbOve0hFY4U5g+8ou/PSknhP4A8EkwhcYJbmMoTOn5hdW85WOXkZrNyMoz0Ec6NJYbDPb7UYPnXwy4UYbUuGfQB5CijdtcjB6vy3PBY+CbBiqzGWbYC/5TGO5khBwtWhsw3HQSqkFQljXssW53MsIoqcmSwPcj0Yc7ZOKfFbwW66U/6x0crpnzMQf2uJwtyXH5kGnBqB2uuTzr/LEtVVqNtewxGvdEY53OVluXaaZZSlnDKacvvrQ1oMGnvuVM5RM1zVm07VfVCE23Y/ygCHX9hvcR/YlquDEx+GdUVT4pyKKSZW+YPiljC1EhLPbsNj+Ds2PX5xUiv6Kc0AZQGs2hPt0ok266Pu1slzTIZZvqwzyG0cnqFsGwwYoNnuDLSGw6Uk/0eznLKVgCTUgJwto8QCHMPM33/yymryNSE5TGrWXKCghFpc+DRq8rOpcv6O20sWXI57ngOsbQxZzLS42yB9tGWpbJkCUp6FAfx43ZliXKu4MZpS+XUKCHfHYDDfGQH0Ad+V1F7pGWJJUsdeFev0pz3NDFnFbfFW5CxWNZR0oxdRNqDPfgfpEnGaOVCQqdlqdNVm1PPIecThcw8qBNo50bzJ7+i1CQrEttWedeylMfItUd+nk847dKOXAlPKQ5o5+tYT5Rq2p327rl77nVr2YMLt0RbOCNc7drDSwV61t2IB/8QLbZbUES35/PO8zt3mv7pJ0aGPtpyCwK3iwZ9RrNd5flDf/veSUTIWG5B/tpV9jv2Xubeoq5mF3lk1DuJvveBbvuheLktZ+mteSYf/j1oGxtnjN0+EbQ5deLdmP9atPr+pb9EZ9YnSHP+WnyuLeqQWKrS3Q90oeDmtElA4M5FHC0/DYZbRZbFGTKP2TZ9KICvHSfGliV2nIFuhE9t4NGi8XWoynDx4nVdlvWMaYq+JSF0VcFyeqjV3zYR118tWr13uVpmAfLzErYwXbR9LSun7ltz9tPSc0L/gkGvpbrHzmUT2ULy7AJ0VQliWeUEHepbERMnDO8KtL3siXeZc3jvk7Wly1awjWMk+mYuu2hZl4w2b3PW13E11qCTVra7+RInuqbUNwVSyNn2gq2SFCRi924su11fOMMZpL/IlPulLqLzhWDZxDFif4n2e+zFPCVJ9Pe1fsO7WBU/ffQa5Da8fD7afvronWK+4IGKxOEtVS63PblFnamJaev7MgRXkf/lxPEKpW0ZLqJzZx/jlPvl2TAdZwfVWs7FCxeRLtJQHRt+grN1SQj1dqodtj2ACvI/wZeKnkWuZZ8AAAAASUVORK5CYII=
// @run-at       document-start
// @match        *://*/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// @grant        GM_registerMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @license       Apache-2.0
// @require       https://unpkg.com/i18n-jsautotranslate@3.18.89/index.js
// @downloadURL https://update.greasyfork.org/scripts/546362/%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%8A%A9%E6%89%8B.user.js
// @updateURL https://update.greasyfork.org/scripts/546362/%E6%99%BA%E8%83%BD%E7%BF%BB%E8%AF%91%E5%8A%A9%E6%89%8B.meta.js
// ==/UserScript==

(function() {
    'use strict';

    // Â∞ΩÊó©Ê≥®ÂÖ•Ê†∑ÂºèÂíåÂàõÂª∫ÊÇ¨ÊµÆÁêÉ
    const earlyInit = () => {
        // Ê£ÄÊµãÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á
        const isMobile = () => {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                || window.innerWidth <= 768;
        };

        // Ëé∑Âèñ‰øùÂ≠òÁöÑÈÖçÁΩÆ
        const getConfig = () => {
            const defaultConfig = {
                enabled: true,
                localLanguage: 'english',
                targetLanguage: 'chinese_simplified',
                floatBallSize: isMobile() ? 45 : 50,
                floatBallPosition: { x: 20, y: 100 },
                floatBallOpacity: 0.8,
                autoTranslate: false,
                showFloatBall: true,
                translateService: 'client.edge',
                customServiceUrls: '',
                allowHalfBall: true,
                panelPosition: null,
                panelSize: isMobile() ? 0.9 : 1,
                panelOpacity: 1,
                ignoredClasses: '',
                ignoredIds: '',
                ignoredTags: [],
                customTerms: '',
                enableListener: true,
                enableCache: true,
                translateAttributes: ['title', 'alt', 'placeholder'],
                doubleClickToggle: false,
                enableOffline: false,
                enableSelectionTranslate: false
            };
            const saved = GM_getValue('translateConfig', null);
            return saved ? { ...defaultConfig, ...saved } : defaultConfig;
        };

        const config = getConfig();
        const mobile = isMobile();

        // Ê£ÄÊµãÊ∑±Ëâ≤Ê®°Âºè
        const isDarkMode = () => {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        };

        // Ê≥®ÂÖ•Âü∫Á°ÄÊ†∑Âºè
        const baseStyles = `
            #translate-float-ball {
                position: fixed;
                width: ${config.floatBallSize}px;
                height: ${config.floatBallSize}px;
                border-radius: 50%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                cursor: ${mobile ? 'pointer' : 'move'};
                z-index: 2147483647;
                display: ${config.showFloatBall ? 'flex' : 'none'};
                align-items: center;
                justify-content: center;
                opacity: ${config.floatBallOpacity};
                left: ${config.floatBallPosition.x}px;
                top: ${config.floatBallPosition.y}px;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                user-select: none;
                -webkit-user-select: none;
                touch-action: none;
            }
            #translate-float-ball svg {
                width: ${mobile ? '24px' : '28px'};
                height: ${mobile ? '24px' : '28px'};
                fill: white;
                pointer-events: none;
            }
        `;

        // ÂàõÂª∫styleÊ†áÁ≠æ
        const style = document.createElement('style');
        style.textContent = baseStyles;
        
        // ÂàõÂª∫ÊÇ¨ÊµÆÁêÉ
        const ball = document.createElement('div');
        ball.id = 'translate-float-ball';
        ball.innerHTML = `
            <svg viewBox="0 0 24 24">
                <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
            </svg>
        `;

        // Á≠âÂæÖDOMÂáÜÂ§áÂ•Ω
        if (document.head) {
            document.head.appendChild(style);
        } else {
            document.addEventListener('DOMContentLoaded', () => {
                document.head.appendChild(style);
            });
        }

        if (document.body) {
            document.body.appendChild(ball);
        } else {
            document.addEventListener('DOMContentLoaded', () => {
                document.body.appendChild(ball);
            });
        }
    };

    // Á´ãÂç≥ÊâßË°åÊó©ÊúüÂàùÂßãÂåñ
    earlyInit();

    // ‰∏ªË¶ÅÂäüËÉΩ‰ª£Á†Å
    (() => {
        // ÈÖçÁΩÆÁÆ°ÁêÜÂô®
        class ConfigManager {
            constructor() {
                this.defaultConfig = {
                    enabled: true,
                    localLanguage: 'english',
                    targetLanguage: 'chinese_simplified',
                    floatBallSize: isMobile() ? 45 : 50,
                    floatBallPosition: { x: 20, y: 100 },
                    floatBallOpacity: 0.8,
                    autoTranslate: false,
                    showFloatBall: true,
                    translateService: 'client.edge',
                    customServiceUrls: '',
                    allowHalfBall: true,
                    panelPosition: null,
                    panelSize: isMobile() ? 0.9 : 1,
                    panelOpacity: 1,
                    ignoredClasses: '',
                    ignoredIds: '',
                    ignoredTags: [],
                    customTerms: '',
                    enableListener: true,
                    enableCache: true,
                    translateAttributes: ['title', 'alt', 'placeholder'],
                    doubleClickToggle: false,
                    enableOffline: false,
                    enableSelectionTranslate: false
                };
                this.config = this.loadConfig();
            }

            loadConfig() {
                const saved = GM_getValue('translateConfig', null);
                return saved ? { ...this.defaultConfig, ...saved } : this.defaultConfig;
            }

            saveConfig() {
                GM_setValue('translateConfig', this.config);
            }

            get(key) {
                return this.config[key];
            }

            set(key, value) {
                this.config[key] = value;
                this.saveConfig();
            }

            reset() {
                GM_deleteValue('translateConfig');
                this.config = { ...this.defaultConfig };
            }

            clearCache() {
                // Ê∏ÖÈô§translate.jsÁöÑÁºìÂ≠ò
                if (typeof translate !== 'undefined') {
                    try {
                        translate.storage.clear();
                    } catch (e) {
                        console.log('Ê∏ÖÈô§translate.jsÁºìÂ≠òÂ§±Ë¥•:', e);
                    }
                }
                
                // Ê∏ÖÈô§localStorage‰∏≠ÁöÑÁøªËØëÁºìÂ≠ò
                const keys = Object.keys(localStorage);
                let cleared = 0;
                keys.forEach(key => {
                    if (key.includes('translate_') || key.includes('hash_')) {
                        localStorage.removeItem(key);
                        cleared++;
                    }
                });
                
                return cleared;
            }
        }

        // ÁøªËØëÁÆ°ÁêÜÂô®
        class TranslateManager {
            constructor(configManager) {
                this.configManager = configManager;
                this.initialized = false;
                this.listenerStarted = false;
                this.currentLanguage = null;
                this.isTranslating = false;
                this.observer = null;
            }

            init() {
                if (this.initialized || typeof translate === 'undefined') return;
                
                try {
                    // ÈÖçÁΩÆtranslate.js
                    translate.language.setLocal(this.configManager.get('localLanguage'));
                    
                    // ËÆæÁΩÆÁøªËØëÊúçÂä°
                    const service = this.configManager.get('translateService');
                    translate.service.use(service);
                    
                    // Â¶ÇÊûúÊòØËá™ÂÆö‰πâÊúçÂä°,ËÆæÁΩÆAPIÂú∞ÂùÄ
                    if (service === 'translate.service') {
                        const customUrls = this.configManager.get('customServiceUrls');
                        if (customUrls) {
                            const urls = customUrls.split(',').map(url => url.trim()).filter(url => url);
                            if (urls.length > 0) {
                                translate.request.api.host = urls.length === 1 ? urls[0] : urls;
                            }
                        }
                    }
                    
                    translate.selectLanguageTag.show = false;
                    
                    // ËÆæÁΩÆÂøΩÁï•ÁöÑÁ±ªÂíåID
                    this.applyIgnoreSettings();
                    
                    // ËÆæÁΩÆËá™ÂÆö‰πâÊúØËØ≠
                    this.applyCustomTerms();

                    // ËÆæÁΩÆË¶ÅÁøªËØëÁöÑÂ±ûÊÄß
                    const translateAttributes = this.configManager.get('translateAttributes');
                    if (translateAttributes.length > 0) {
                        translate.translateAttributes = translateAttributes;
                    }

                    this.initialized = true;
                    console.log('ÁøªËØëÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');
                } catch (error) {
                    console.error('ÁøªËØëÂàùÂßãÂåñÂ§±Ë¥•:', error);
                }
            }

            applyIgnoreSettings() {
                if (typeof translate === 'undefined') return;
                
                // Ê∏ÖÁ©∫Áé∞ÊúâËÆæÁΩÆ
                translate.ignore.class = [];
                translate.ignore.id = [];
                
                // Â∫îÁî®ÂøΩÁï•ÁöÑClass
                const ignoredClasses = this.configManager.get('ignoredClasses');
                if (ignoredClasses) {
                    const classes = ignoredClasses.split(',').map(c => c.trim()).filter(c => c);
                    classes.forEach(cls => {
                        translate.ignore.class.push(cls);
                    });
                }
                
                // Â∫îÁî®ÂøΩÁï•ÁöÑID
                const ignoredIds = this.configManager.get('ignoredIds');
                if (ignoredIds) {
                    const ids = ignoredIds.split(',').map(id => id.trim()).filter(id => id);
                    ids.forEach(id => {
                        translate.ignore.id.push(id);
                    });
                }
            }

            applyCustomTerms() {
                if (typeof translate === 'undefined') return;
                
                const customTerms = this.configManager.get('customTerms');
                if (!customTerms) return;
                
                const localLang = this.configManager.get('localLanguage');
                const targetLang = this.configManager.get('targetLanguage');
                
                // Áõ¥Êé•‰ΩøÁî®Áî®Êà∑ËæìÂÖ•ÁöÑÊ†ºÂºè
                translate.nomenclature.append(localLang, targetLang, customTerms);
            }

            startListener() {
                if (!this.listenerStarted && typeof translate !== 'undefined') {
                    try {
                        if (this.configManager.get('enableListener')) {
                            translate.listener.start();
                            this.listenerStarted = true;
                            console.log('Âä®ÊÄÅÂÜÖÂÆπÁõëÂê¨Â∑≤ÂêØÂä®');
                        }
                    } catch (error) {
                        if (!error.message?.includes('Â∑≤ÁªèÂêØÂä®')) {
                            console.error('ÂêØÂä®ÁõëÂê¨Â§±Ë¥•:', error);
                        }
                    }
                }
            }

            changeLanguage(targetLang) {
                if (!this.initialized) this.init();
                if (typeof translate === 'undefined') return;
                
                try {
                    // ÈÅøÂÖçÈáçÂ§çÁøªËØëÂà∞Áõ∏ÂêåËØ≠Ë®Ä
                    if (this.currentLanguage === targetLang && this.isTranslating) {
                        return;
                    }
                    
                    this.currentLanguage = targetLang;
                    this.isTranslating = true;
                    
                    // ÈáçÊñ∞Â∫îÁî®ÂøΩÁï•ËÆæÁΩÆÂíåËá™ÂÆö‰πâÊúØËØ≠
                    this.applyIgnoreSettings();
                    this.applyCustomTerms();
                    
                    // Á°Æ‰øùÁõëÂê¨Âô®Â∑≤ÂêØÂä®
                    this.startListener();
                    
                    translate.changeLanguage(targetLang);
                    
                    // ÁøªËØëÂÆåÊàêÂêéÈáçÁΩÆÁä∂ÊÄÅ
                    setTimeout(() => {
                        this.isTranslating = false;
                    }, 1000);
                } catch (error) {
                    console.error('ÂàáÊç¢ËØ≠Ë®ÄÂ§±Ë¥•:', error);
                    this.isTranslating = false;
                }
            }

            toggle(enabled) {
                if (enabled && !this.initialized) {
                    this.init();
                    this.startListener();
                    if (this.configManager.get('autoTranslate')) {
                        setTimeout(() => {
                            this.changeLanguage(this.configManager.get('targetLanguage'));
                        }, 100);
                    }
                } else if (!enabled && this.initialized) {
                    this.isTranslating = false;
                    this.changeLanguage(this.configManager.get('localLanguage'));
                }
            }

            execute() {
                if (!this.initialized) this.init();
                if (typeof translate !== 'undefined') {
                    try {
                        // ÈáçÊñ∞Â∫îÁî®ËÆæÁΩÆ
                        this.applyIgnoreSettings();
                        this.applyCustomTerms();
                        
                        this.startListener();
                        translate.execute();
                    } catch (error) {
                        console.error('ÊâßË°åÁøªËØëÂ§±Ë¥•:', error);
                    }
                }
            }

            startSelectionTranslate() {
                if (!this.initialized) this.init();
                if (typeof translate !== 'undefined') {
                    try {
                        translate.language.setDefaultTo(this.configManager.get('targetLanguage'));
                        translate.selectionTranslate.start();
                        console.log('Èº†Ê†áÂàíËØçÁøªËØëÂ∑≤ÂêØÂä®');
                    } catch (error) {
                        console.error('ÂêØÂä®ÂàíËØçÁøªËØëÂ§±Ë¥•:', error);
                    }
                }
            }

            stopSelectionTranslate() {
                if (typeof translate !== 'undefined' && translate.selectionTranslate) {
                    try {
                        translate.selectionTranslate.stop();
                        console.log('Èº†Ê†áÂàíËØçÁøªËØëÂ∑≤ÂÅúÊ≠¢');
                    } catch (error) {
                        console.error('ÂÅúÊ≠¢ÂàíËØçÁøªËØëÂ§±Ë¥•:', error);
                    }
                }
            }
        }

        // ÊèêÁ§∫ÁÆ°ÁêÜÂô®
        class ToastManager {
            constructor() {
                this.container = null;
                this.init();
            }

            init() {
                this.container = document.createElement('div');
                this.container.id = 'translate-toast-container';
                this.container.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 2147483647;
                    pointer-events: none;
                `;
                document.body.appendChild(this.container);
            }

            show(message, type = 'success', duration = 2000) {
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3';
                
                toast.style.cssText = `
                    background: ${bgColor};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    margin-bottom: 10px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    animation: slideInRight 0.3s ease;
                    pointer-events: auto;
                    font-size: 14px;
                `;
                
                toast.textContent = message;
                this.container.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        this.container.removeChild(toast);
                    }, 300);
                }, duration);
            }
        }

        // UIÁÆ°ÁêÜÂô®
        class UIManager {
            constructor(configManager, translateManager) {
                this.configManager = configManager;
                this.translateManager = translateManager;
                this.floatBall = document.getElementById('translate-float-ball');
                this.panel = null;
                this.toast = new ToastManager();
                this.isDragging = false;
                this.isPanelDragging = false;
                this.dragOffset = { x: 0, y: 0 };
                this.panelDragOffset = { x: 0, y: 0 };
                this.touchStartPos = { x: 0, y: 0 };
                this.touchStartTime = 0;
                this.lastClickTime = 0;
                this.clickCount = 0;
                this.clickTimer = null;
                
                this.init();
            }

            init() {
                this.injectStyles();
                this.setupFloatBall();
                this.createPanel();
                this.bindEvents();
                
                // ÂàùÂßãÂåñÁøªËØë
                if (this.configManager.get('enabled')) {
                    setTimeout(() => {
                        this.translateManager.toggle(true);
                    }, 1000);
                }
                
                // ÂàùÂßãÂåñÈº†Ê†áÂàíËØçÁøªËØë
                if (this.configManager.get('enableSelectionTranslate') && !isMobile()) {
                    setTimeout(() => {
                        this.translateManager.startSelectionTranslate();
                    }, 1500);
                }
            }

            injectStyles() {
                const mobile = isMobile();
                const darkMode = isDarkMode();
                
                GM_addStyle(`
                    /* Âä®ÁîªÂÆö‰πâ */
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    
                    @keyframes slideOutRight {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                    
                    /* Ê∑±Ëâ≤Ê®°ÂºèÊîØÊåÅ */
                    ${darkMode ? `
                        #translate-panel {
                            background: #1e1e1e !important;
                            color: #e0e0e0 !important;
                        }
                        
                        .translate-panel-header {
                            background: linear-gradient(135deg, #4a5eb7 0%, #5a3d7a 100%) !important;
                        }
                        
                        .translate-control-label {
                            color: #e0e0e0 !important;
                        }
                        
                        .translate-select, .translate-input, .translate-textarea {
                            background: #2d2d2d !important;
                            color: #e0e0e0 !important;
                            border-color: #444 !important;
                        }
                        
                        .translate-select:focus, .translate-input:focus, .translate-textarea:focus {
                            border-color: #667eea !important;
                        }
                        
                        .translate-select option {
                            background: #2d2d2d !important;
                            color: #e0e0e0 !important;
                        }
                        
                        .translate-slider {
                            background: #444 !important;
                        }
                        
                        .translate-slider-value {
                            color: #b0b0b0 !important;
                        }
                        
                        .translate-section-title {
                            color: #e0e0e0 !important;
                            border-bottom-color: #444 !important;
                        }
                        
                        .translate-info {
                            background: #2d2d2d !important;
                            color: #b0b0b0 !important;
                        }
                        
                        .translate-description {
                            color: #999 !important;
                        }
                    ` : ''}
                    
                    /* ÊÇ¨ÊµÆÁêÉÂä®ÁîªÊ†∑Âºè */
                    #translate-float-ball:active {
                        transform: scale(0.95);
                    }

                    #translate-float-ball.dragging {
                        transition: none !important;
                        transform: scale(1.1);
                        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
                    }

                    #translate-float-ball:hover {
                        transform: scale(1.05);
                        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
                    }

                    /* ÊéßÂà∂Èù¢ÊùøÊ†∑Âºè */
                    #translate-panel {
                        position: fixed;
                        background: white;
                        border-radius: 12px;
                        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
                        z-index: 2147483646;
                        display: none;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                        overflow: hidden;
                        touch-action: none;
                        user-select: none;
                        -webkit-user-select: none;
                    }

                    #translate-panel.show {
                        display: block;
                        animation: slideIn 0.3s ease;
                    }

                    #translate-panel.dragging {
                        transition: none !important;
                        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
                    }

                    @keyframes slideIn {
                        from {
                            opacity: 0;
                            transform: translateY(-20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }

                    .translate-panel-header {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: ${mobile ? '15px' : '20px'};
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        cursor: move;
                    }

                    .translate-panel-title {
                        font-size: ${mobile ? '16px' : '18px'};
                        font-weight: 600;
                        user-select: none;
                    }

                    .translate-panel-close {
                        width: 30px;
                        height: 30px;
                        border-radius: 50%;
                        background: rgba(255, 255, 255, 0.2);
                        border: none;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.3s;
                        font-size: 18px;
                        color: white;
                    }

                    .translate-panel-close:hover {
                        background: rgba(255, 255, 255, 0.3);
                    }

                    .translate-panel-close:active {
                        transform: scale(0.95);
                    }

                    .translate-panel-body {
                        padding: ${mobile ? '15px' : '20px'};
                        max-height: ${mobile ? '60vh' : '500px'};
                        overflow-y: auto;
                        -webkit-overflow-scrolling: touch;
                        cursor: default;
                    }

                    .translate-panel-body::-webkit-scrollbar {
                        width: 6px;
                    }

                    .translate-panel-body::-webkit-scrollbar-thumb {
                        background: rgba(0,0,0,0.2);
                        border-radius: 3px;
                    }

                    .translate-panel-body::-webkit-scrollbar-track {
                        background: transparent;
                    }

                    .translate-control-group {
                        margin-bottom: ${mobile ? '15px' : '20px'};
                    }

                    .translate-control-label {
                        display: block;
                        margin-bottom: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        color: #333;
                    }

                    .translate-description {
                        font-size: 12px;
                        color: #666;
                        margin-top: 4px;
                        font-weight: normal;
                    }

                    .translate-switch {
                        position: relative;
                        display: inline-block;
                        width: 50px;
                        height: 24px;
                    }

                    .translate-switch input {
                        opacity: 0;
                        width: 0;
                        height: 0;
                    }

                    .translate-switch-slider {
                        position: absolute;
                        cursor: pointer;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background-color: #ccc;
                        transition: .4s;
                        border-radius: 24px;
                    }

                    .translate-switch-slider:before {
                        position: absolute;
                        content: "";
                        height: 18px;
                        width: 18px;
                        left: 3px;
                        bottom: 3px;
                        background-color: white;
                        transition: .4s;
                        border-radius: 50%;
                    }

                    .translate-switch input:checked + .translate-switch-slider {
                        background-color: #667eea;
                    }

                    .translate-switch input:checked + .translate-switch-slider:before {
                        transform: translateX(26px);
                    }

                    .translate-select, .translate-input {
                        width: 100%;
                        padding: ${mobile ? '12px' : '10px'};
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: ${mobile ? '16px' : '14px'};
                        background: white;
                        cursor: pointer;
                        transition: border-color 0.3s;
                        color: #333;
                        box-sizing: border-box;
                    }

                    .translate-select:focus, .translate-input:focus {
                        outline: none;
                        border-color: #667eea;
                    }

                    .translate-textarea {
                        width: 100%;
                        min-height: 100px;
                        padding: ${mobile ? '12px' : '10px'};
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        font-size: ${mobile ? '14px' : '13px'};
                        background: white;
                        transition: border-color 0.3s;
                        color: #333;
                        box-sizing: border-box;
                        resize: vertical;
                        font-family: monospace;
                        line-height: 1.5;
                    }

                    .translate-textarea:focus {
                        outline: none;
                        border-color: #667eea;
                    }

                    .translate-slider-container {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }

                    .translate-slider {
                        flex: 1;
                        -webkit-appearance: none;
                        height: 6px;
                        border-radius: 3px;
                        background: #ddd;
                        outline: none;
                    }

                    .translate-slider::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        appearance: none;
                        width: 18px;
                        height: 18px;
                        border-radius: 50%;
                        background: #667eea;
                        cursor: pointer;
                    }

                    .translate-slider::-moz-range-thumb {
                        width: 18px;
                        height: 18px;
                        border-radius: 50%;
                        background: #667eea;
                        cursor: pointer;
                        border: none;
                    }

                    .translate-slider-value {
                        min-width: 45px;
                        text-align: center;
                        font-size: 14px;
                        color: #666;
                    }

                    .translate-button {
                        width: 100%;
                        padding: ${mobile ? '14px' : '12px'};
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: ${mobile ? '16px' : '14px'};
                        font-weight: 500;
                        cursor: pointer;
                        transition: transform 0.3s, box-shadow 0.3s;
                        -webkit-tap-highlight-color: transparent;
                    }

                    .translate-button:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
                    }

                    .translate-button:active {
                        transform: scale(0.98);
                    }

                    .translate-button-group {
                        display: flex;
                        gap: 10px;
                        margin-bottom: ${mobile ? '15px' : '20px'};
                    }

                    .translate-button-group .translate-button {
                        flex: 1;
                    }

                    .translate-section-title {
                        font-size: ${mobile ? '15px' : '16px'};
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 15px;
                        padding-bottom: 10px;
                        border-bottom: 2px solid #f0f0f0;
                    }

                    .translate-info {
                        background: #f8f9fa;
                        padding: 12px;
                        border-radius: 8px;
                        font-size: ${mobile ? '12px' : '13px'};
                        color: #666;
                        margin-top: 10px;
                        line-height: 1.5;
                    }

                    /* ÂìçÂ∫îÂºè‰ºòÂåñ */
                    @media (max-width: 768px) {
                        .translate-control-group {
                            margin-bottom: 15px;
                        }
                    }
                `);
            }

            setupFloatBall() {
                if (!this.floatBall) return;
                
                const size = this.configManager.get('floatBallSize');
                const position = this.configManager.get('floatBallPosition');
                const opacity = this.configManager.get('floatBallOpacity');
                
                this.floatBall.style.width = `${size}px`;
                this.floatBall.style.height = `${size}px`;
                this.floatBall.style.opacity = opacity;
                
                // Á°Æ‰øùÂú®ÂèØËßÜÂå∫ÂüüÂÜÖ
                this.ensureInViewport();
            }

            createPanel() {
                const panel = document.createElement('div');
                panel.id = 'translate-panel';
                
                // Ëé∑ÂèñÊîØÊåÅÁöÑËØ≠Ë®ÄÂàóË°®
                const languages = this.getSupportedLanguages();
                
                // Ëé∑ÂèñÁøªËØëÊúçÂä°ÂàóË°®
                const services = [
                    { value: 'client.edge', name: 'Microsoft Edge' },
                    { value: 'client.google', name: 'Google Translate' },
                    { value: 'siliconflow', name: 'SiliconFlow AI' },
                    { value: 'translate.service', name: 'Ëá™ÂÆö‰πâÊúçÂä°' }
                ];

                const mobile = isMobile();
                const config = this.configManager.config;

                panel.innerHTML = `
                    <div class="translate-panel-header">
                        <div class="translate-panel-title">üåê Êô∫ËÉΩÁøªËØëÂä©Êâã</div>
                        <button class="translate-panel-close" id="translate-panel-close">‚úï</button>
                    </div>
                    <div class="translate-panel-body">
                        <!-- Á´ãÂç≥ÁøªËØëÊåâÈíÆ - ÊîæÂú®ÊúÄ‰∏äÈù¢ -->
                        <div class="translate-control-group">
                            <button class="translate-button" id="translate-now-btn">üöÄ Á´ãÂç≥ÁøªËØë</button>
                        </div>

                        <!-- Âü∫Á°ÄËÆæÁΩÆ -->
                        <div class="translate-section-title">Âü∫Á°ÄËÆæÁΩÆ</div>
                        
                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                Ê∫êËØ≠Ë®Ä
                                <div class="translate-description">ÂΩìÂâçÈ°µÈù¢ÁöÑËØ≠Ë®Ä</div>
                            </label>
                            <select class="translate-select" id="translate-local-lang">
                                ${languages.map(lang => `
                                    <option value="${lang.value}" ${config.localLanguage === lang.value ? 'selected' : ''}>
                                        ${lang.name}
                                    </option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÁõÆÊ†áËØ≠Ë®Ä
                                <div class="translate-description">Ë¶ÅÁøªËØëÊàê‰ªÄ‰πàËØ≠Ë®Ä</div>
                            </label>
                            <select class="translate-select" id="translate-target-lang">
                                ${languages.map(lang => `
                                    <option value="${lang.value}" ${config.targetLanguage === lang.value ? 'selected' : ''}>
                                        ${lang.name}
                                    </option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÂêØÁî®ÁøªËØë</label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-enable" ${config.enabled ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                Ëá™Âä®ÁøªËØë
                                <div class="translate-description">È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®ÁøªËØë</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-auto" ${config.autoTranslate ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <!-- ÁïåÈù¢ËÆæÁΩÆ -->
                        <div class="translate-section-title" style="margin-top: 25px;">ÁïåÈù¢ËÆæÁΩÆ</div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÊòæÁ§∫ÊÇ¨ÊµÆÁêÉ</label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-show-ball" ${config.showFloatBall ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÂÖÅËÆ∏ÊÇ¨ÊµÆÁêÉË∂ÖÂá∫ËæπÁºò
                                <div class="translate-description">ÂÖÅËÆ∏ÊÇ¨ÊµÆÁêÉ‰∏ÄÂçäË∂ÖÂá∫Â±èÂπïËæπÁºò</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-allow-half" ${config.allowHalfBall ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÂèåÂáªÊÇ¨ÊµÆÁêÉÂºÄÂÖ≥ÁøªËØë
                                <div class="translate-description">Âø´ÈÄüÂèåÂáªÊÇ¨ÊµÆÁêÉÂºÄÂêØ/ÂÖ≥Èó≠ÁøªËØë</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-double-click" ${config.doubleClickToggle ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÊÇ¨ÊµÆÁêÉÂ§ßÂ∞è</label>
                            <div class="translate-slider-container">
                                <input type="range" class="translate-slider" id="translate-ball-size" 
                                    min="30" max="80" value="${config.floatBallSize}">
                                <span class="translate-slider-value">${config.floatBallSize}px</span>
                            </div>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÊÇ¨ÊµÆÁêÉÈÄèÊòéÂ∫¶</label>
                            <div class="translate-slider-container">
                                <input type="range" class="translate-slider" id="translate-ball-opacity" 
                                    min="30" max="100" value="${config.floatBallOpacity * 100}">
                                <span class="translate-slider-value">${Math.round(config.floatBallOpacity * 100)}%</span>
                            </div>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÊéßÂà∂Èù¢ÊùøÂ§ßÂ∞è</label>
                            <div class="translate-slider-container">
                                <input type="range" class="translate-slider" id="translate-panel-size" 
                                    min="50" max="120" value="${config.panelSize * 100}">
                                <span class="translate-slider-value">${Math.round(config.panelSize * 100)}%</span>
                            </div>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">ÊéßÂà∂Èù¢ÊùøÈÄèÊòéÂ∫¶</label>
                            <div class="translate-slider-container">
                                <input type="range" class="translate-slider" id="translate-panel-opacity" 
                                    min="50" max="100" value="${config.panelOpacity * 100}">
                                <span class="translate-slider-value">${Math.round(config.panelOpacity * 100)}%</span>
                            </div>
                        </div>

                        <div class="translate-button-group">
                            <button class="translate-button" id="translate-reset-ball-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                ÈáçÁΩÆÊÇ¨ÊµÆÁêÉ‰ΩçÁΩÆ
                            </button>
                            <button class="translate-button" id="translate-reset-panel-btn" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                ÈáçÁΩÆÈù¢Êùø‰ΩçÁΩÆ
                            </button>
                        </div>

                        <!-- È´òÁ∫ßËÆæÁΩÆ -->
                        <div class="translate-section-title" style="margin-top: 25px;">È´òÁ∫ßËÆæÁΩÆ</div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÁøªËØëÊúçÂä°
                                <div class="translate-description">ÈÄâÊã©ÁøªËØëÊúçÂä°ÈÄöÈÅì</div>
                            </label>
                            <select class="translate-select" id="translate-service">
                                ${services.map(service => `
                                    <option value="${service.value}" ${config.translateService === service.value ? 'selected' : ''}>
                                        ${service.name}
                                    </option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="translate-control-group" id="custom-service-group" style="display: ${config.translateService === 'translate.service' ? 'block' : 'none'};">
                            <label class="translate-control-label">
                                Ëá™ÂÆö‰πâÁøªËØëÊé•Âè£Âú∞ÂùÄ
                                <div class="translate-description">ÊîØÊåÅÂ§ö‰∏™Âú∞ÂùÄ,Áî®Ëã±ÊñáÈÄóÂè∑ÂàÜÈöî</div>
                            </label>
                            <input type="text" class="translate-input" id="custom-service-urls" 
                                placeholder="‰æãÂ¶Ç: https://api1.com/,https://api2.com/" 
                                value="${config.customServiceUrls}">
                            <button class="translate-button" id="save-custom-service" style="margin-top: 8px;">‰øùÂ≠òÊé•Âè£Âú∞ÂùÄ</button>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÂøΩÁï•ÁöÑClass
                                <div class="translate-description">Ê∑ªÂä†‰∏çÈúÄË¶ÅÁøªËØëÁöÑCSSÁ±ªÂêç,Áî®Ëã±ÊñáÈÄóÂè∑ÂàÜÈöî</div>
                            </label>
                            <input type="text" class="translate-input" id="ignore-class-input" 
                                placeholder="‰æãÂ¶Ç: class1,class2,class3" 
                                value="${config.ignoredClasses}">
                            <button class="translate-button" id="save-ignore-class" style="margin-top: 8px;">‰øùÂ≠òClassËÆæÁΩÆ</button>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÂøΩÁï•ÁöÑID
                                <div class="translate-description">Ê∑ªÂä†‰∏çÈúÄË¶ÅÁøªËØëÁöÑÂÖÉÁ¥†ID,Áî®Ëã±ÊñáÈÄóÂè∑ÂàÜÈöî</div>
                            </label>
                            <input type="text" class="translate-input" id="ignore-id-input" 
                                placeholder="‰æãÂ¶Ç: id1,id2,id3" 
                                value="${config.ignoredIds}">
                            <button class="translate-button" id="save-ignore-id" style="margin-top: 8px;">‰øùÂ≠òIDËÆæÁΩÆ</button>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                Ëá™ÂÆö‰πâÊúØËØ≠
                                <div class="translate-description">ÊØèË°å‰∏Ä‰∏™ÊúØËØ≠,Ê†ºÂºè: ÂéüÊñá=ÁøªËØë</div>
                            </label>
                            <textarea class="translate-textarea" id="custom-terms-input" 
                                placeholder="‰æãÂ¶Ç:&#10;ÁΩëÂ∏ÇÂú∫‰∫ëÂª∫Á´ôÁ≥ªÁªü=wangmarket CMS&#10;ÂõΩÈôÖÂåñ=GuoJiHua">${config.customTerms}</textarea>
                            <button class="translate-button" id="save-custom-terms" style="margin-top: 8px;">‰øùÂ≠òÊúØËØ≠ËÆæÁΩÆ</button>
                        </div>

                        ${!mobile ? `
                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                Èº†Ê†áÂàíËØçÁøªËØë
                                <div class="translate-description">ÈÄâ‰∏≠ÊñáÂ≠óËá™Âä®ÊòæÁ§∫ÁøªËØë(‰ªÖPCÁ´Ø)</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-selection" ${config.enableSelectionTranslate ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>
                        ` : ''}

                        <!-- ÊÄßËÉΩ‰ºòÂåñ -->
                        <div class="translate-section-title" style="margin-top: 25px;">ÊÄßËÉΩ‰ºòÂåñ</div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                Âä®ÊÄÅÂÜÖÂÆπÁõëÂê¨
                                <div class="translate-description">Ëá™Âä®ÁøªËØëÂä®ÊÄÅÂä†ËΩΩÁöÑÂÜÖÂÆπ</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-listener" ${config.enableListener ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-control-group">
                            <label class="translate-control-label">
                                ÁºìÂ≠ò‰ºòÂåñ
                                <div class="translate-description">ÁºìÂ≠òÁøªËØëÁªìÊûú,ÊèêÂçáÂìçÂ∫îÈÄüÂ∫¶</div>
                            </label>
                            <label class="translate-switch">
                                <input type="checkbox" id="translate-cache" ${config.enableCache ? 'checked' : ''}>
                                <span class="translate-switch-slider"></span>
                            </label>
                        </div>

                        <div class="translate-button-group">
                            <button class="translate-button" id="translate-clear-cache" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                                Ê∏ÖÈô§ÁøªËØëÁºìÂ≠ò
                            </button>
                            <button class="translate-button" id="translate-reset-all" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                                ÈáçÁΩÆÊâÄÊúâËÆæÁΩÆ
                            </button>
                        </div>

                        <div class="translate-info">
                            üí° ÊèêÁ§∫:${mobile ? 'ÈïøÊåâ' : 'ÊãñÂä®'}ÊÇ¨ÊµÆÁêÉÊàñÈù¢ÊùøÊ†áÈ¢òÊ†èÂèØË∞ÉÊï¥‰ΩçÁΩÆ,ËÆæÁΩÆ‰ºöËá™Âä®‰øùÂ≠ò<br><br>
                            üöÄ ÊîØÊåÅ100+ÁßçËØ≠Ë®Ä‰∫íËØë,ÈááÁî®AIÁøªËØëÂºïÊìé,ÁøªËØëË¥®ÈáèÊõ¥‰ºò<br>
                            ‚ö° ÂÜÖÁΩÆÂ§öÂ±ÇÁºìÂ≠òÊú∫Âà∂,‰∫åÊ¨°ËÆøÈóÆÊØ´ÁßíÁ∫ßÂìçÂ∫î<br>
                            üîí ÂÆåÂÖ®Êú¨Âú∞ËøêË°å,‰øùÊä§ÊÇ®ÁöÑÈöêÁßÅÂÆâÂÖ®
                        </div>
                    </div>
                `;
                
                document.body.appendChild(panel);
                this.panel = panel;

                // ËÆæÁΩÆÈù¢ÊùøÂàùÂßãÂ§ßÂ∞èÂíåÈÄèÊòéÂ∫¶
                this.updatePanelSize();
                this.panel.style.opacity = config.panelOpacity;

                // ÊÅ¢Â§çÈù¢Êùø‰ΩçÁΩÆ
                if (config.panelPosition) {
                    this.panel.style.left = `${config.panelPosition.x}px`;
                    this.panel.style.top = `${config.panelPosition.y}px`;
                }
            }

            getSupportedLanguages() {
                return [
                    { value: 'chinese_simplified', name: 'ÁÆÄ‰Ωì‰∏≠Êñá' },
                    { value: 'chinese_traditional', name: 'ÁπÅÈ´î‰∏≠Êñá' },
                    { value: 'english', name: 'English' },
                    { value: 'spanish', name: 'Espa√±ol' },
                    { value: 'french', name: 'Fran√ßais' },
                    { value: 'german', name: 'Deutsch' },
                    { value: 'japanese', name: 'Êó•Êú¨Ë™û' },
                    { value: 'korean', name: 'ÌïúÍµ≠Ïñ¥' },
                    { value: 'russian', name: '–†—É—Å—Å–∫–∏–π' },
                    { value: 'arabic', name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' },
                    { value: 'portuguese', name: 'Portugu√™s' },
                    { value: 'italian', name: 'Italiano' },
                    { value: 'dutch', name: 'Nederlands' },
                    { value: 'polish', name: 'Polski' },
                    { value: 'turkish', name: 'T√ºrk√ße' },
                    { value: 'vietnamese', name: 'Ti·∫øng Vi·ªát' },
                    { value: 'hindi', name: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' },
                    { value: 'hebrew', name: '◊¢◊ë◊®◊ô◊™' },
                    { value: 'thai', name: '‡πÑ‡∏ó‡∏¢' },
                    { value: 'indonesian', name: 'Bahasa Indonesia' }
                ];
            }

            updatePanelSize() {
                const mobile = isMobile();
                const size = this.configManager.get('panelSize');
                const baseWidth = mobile ? window.innerWidth * 0.9 : 420;
                const baseHeight = mobile ? window.innerHeight * 0.8 : 650;
                
                const width = Math.min(baseWidth * size, mobile ? window.innerWidth * 0.95 : 650);
                const maxHeight = baseHeight * size;
                
                this.panel.style.width = `${width}px`;
                this.panel.style.maxHeight = `${maxHeight}px`;
                
                // Êõ¥Êñ∞bodyÁöÑÊúÄÂ§ßÈ´òÂ∫¶
                const body = this.panel.querySelector('.translate-panel-body');
                if (body) {
                    body.style.maxHeight = `${maxHeight - 60}px`;
                }
            }

            bindEvents() {
                const mobile = isMobile();

                if (mobile) {
                    this.bindMobileEvents();
                } else {
                    this.bindDesktopEvents();
                }

                this.bindCommonEvents();
                this.bindPanelDragEvents();
            }

            bindPanelDragEvents() {
                const header = this.panel.querySelector('.translate-panel-header');
                const mobile = isMobile();

                if (mobile) {
                    // ÁßªÂä®Á´ØÈù¢ÊùøÊãñÂä®
                    let isDragging = false;
                    let startX, startY, initialX, initialY;
                    let longPressTimer = null;

                    header.addEventListener('touchstart', (e) => {
                        if (e.target.id === 'translate-panel-close') return;
                        
                        const touch = e.touches[0];
                        startX = touch.clientX;
                        startY = touch.clientY;
                        initialX = this.panel.offsetLeft;
                        initialY = this.panel.offsetTop;
                        
                        longPressTimer = setTimeout(() => {
                            isDragging = true;
                            this.panel.classList.add('dragging');
                            if (navigator.vibrate) {
                                navigator.vibrate(50);
                            }
                        }, 300);
                        
                        e.preventDefault();
                    });

                    header.addEventListener('touchmove', (e) => {
                        if (!isDragging) {
                            if (longPressTimer) {
                                const touch = e.touches[0];
                                const moveDistance = Math.sqrt(
                                    Math.pow(touch.clientX - startX, 2) + 
                                    Math.pow(touch.clientY - startY, 2)
                                );
                                if (moveDistance > 10) {
                                    clearTimeout(longPressTimer);
                                    longPressTimer = null;
                                }
                            }
                            return;
                        }
                        
                        const touch = e.touches[0];
                        const dx = touch.clientX - startX;
                        const dy = touch.clientY - startY;
                        
                        let newX = initialX + dx;
                        let newY = initialY + dy;
                        
                        const maxX = window.innerWidth - this.panel.offsetWidth;
                        const maxY = window.innerHeight - this.panel.offsetHeight;
                        
                        newX = Math.max(0, Math.min(newX, maxX));
                        newY = Math.max(0, Math.min(newY, maxY));
                        
                        this.panel.style.left = `${newX}px`;
                        this.panel.style.top = `${newY}px`;
                        
                        e.preventDefault();
                    });

                    header.addEventListener('touchend', () => {
                        if (longPressTimer) {
                            clearTimeout(longPressTimer);
                            longPressTimer = null;
                        }
                        
                        if (isDragging) {
                            isDragging = false;
                            this.panel.classList.remove('dragging');
                            
                            this.configManager.set('panelPosition', {
                                x: parseInt(this.panel.style.left),
                                y: parseInt(this.panel.style.top)
                            });
                        }
                    });
                } else {
                    // PCÁ´ØÈù¢ÊùøÊãñÂä®
                    let isDragging = false;
                    let startX, startY, initialX, initialY;

                    header.addEventListener('mousedown', (e) => {
                        if (e.target.id === 'translate-panel-close') return;
                        
                        isDragging = true;
                        startX = e.clientX;
                        startY = e.clientY;
                        initialX = this.panel.offsetLeft;
                        initialY = this.panel.offsetTop;
                        
                        this.panel.classList.add('dragging');
                        e.preventDefault();
                    });

                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        
                        const dx = e.clientX - startX;
                        const dy = e.clientY - startY;
                        
                        let newX = initialX + dx;
                        let newY = initialY + dy;
                        
                        const maxX = window.innerWidth - this.panel.offsetWidth;
                        const maxY = window.innerHeight - this.panel.offsetHeight;
                        
                        newX = Math.max(0, Math.min(newX, maxX));
                        newY = Math.max(0, Math.min(newY, maxY));
                        
                        this.panel.style.left = `${newX}px`;
                        this.panel.style.top = `${newY}px`;
                    });

                    document.addEventListener('mouseup', () => {
                        if (isDragging) {
                            isDragging = false;
                            this.panel.classList.remove('dragging');
                            
                            this.configManager.set('panelPosition', {
                                x: parseInt(this.panel.style.left),
                                y: parseInt(this.panel.style.top)
                            });
                        }
                    });
                }
            }

            bindMobileEvents() {
                let longPressTimer = null;
                let isDragging = false;
                let hasMoved = false;

                this.floatBall.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.touchStartPos = { x: touch.clientX, y: touch.clientY };
                    this.touchStartTime = Date.now();
                    hasMoved = false;
                    
                    longPressTimer = setTimeout(() => {
                        isDragging = true;
                        this.floatBall.classList.add('dragging');
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    }, 300);

                    this.dragOffset.x = touch.clientX - this.floatBall.offsetLeft;
                    this.dragOffset.y = touch.clientY - this.floatBall.offsetTop;
                });

                this.floatBall.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    
                    const moveDistance = Math.sqrt(
                        Math.pow(touch.clientX - this.touchStartPos.x, 2) + 
                        Math.pow(touch.clientY - this.touchStartPos.y, 2)
                    );
                    
                    if (moveDistance > 10) {
                        hasMoved = true;
                        if (longPressTimer) {
                            clearTimeout(longPressTimer);
                            longPressTimer = null;
                        }
                    }

                    if (isDragging) {
                        let newX = touch.clientX - this.dragOffset.x;
                        let newY = touch.clientY - this.dragOffset.y;
                        
                        if (!this.configManager.get('allowHalfBall')) {
                            const maxX = window.innerWidth - this.floatBall.offsetWidth;
                            const maxY = window.innerHeight - this.floatBall.offsetHeight;
                            newX = Math.max(0, Math.min(newX, maxX));
                            newY = Math.max(0, Math.min(newY, maxY));
                        } else {
                            const halfSize = this.floatBall.offsetWidth / 2;
                            const maxX = window.innerWidth - halfSize;
                            const maxY = window.innerHeight - halfSize;
                            newX = Math.max(-halfSize, Math.min(newX, maxX));
                            newY = Math.max(-halfSize, Math.min(newY, maxY));
                        }
                        
                        this.floatBall.style.left = `${newX}px`;
                        this.floatBall.style.top = `${newY}px`;
                    }
                });

                this.floatBall.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }

                    this.floatBall.classList.remove('dragging');

                    if (isDragging) {
                        this.configManager.set('floatBallPosition', {
                            x: parseInt(this.floatBall.style.left),
                            y: parseInt(this.floatBall.style.top)
                        });
                    } else if (!hasMoved) {
                        this.handleBallClick();
                    }

                    isDragging = false;
                    hasMoved = false;
                });
            }

            bindDesktopEvents() {
                this.floatBall.addEventListener('click', (e) => {
                    if (!this.isDragging) {
                        this.handleBallClick();
                    }
                });

                this.floatBall.addEventListener('mousedown', (e) => {
                    this.isDragging = false;
                    this.dragOffset.x = e.clientX - this.floatBall.offsetLeft;
                    this.dragOffset.y = e.clientY - this.floatBall.offsetTop;
                    this.floatBall.classList.add('dragging');
                    
                    const mouseMoveHandler = (e) => {
                        this.isDragging = true;
                        let newX = e.clientX - this.dragOffset.x;
                        let newY = e.clientY - this.dragOffset.y;
                        
                        if (!this.configManager.get('allowHalfBall')) {
                            const maxX = window.innerWidth - this.floatBall.offsetWidth;
                            const maxY = window.innerHeight - this.floatBall.offsetHeight;
                            newX = Math.max(0, Math.min(newX, maxX));
                            newY = Math.max(0, Math.min(newY, maxY));
                        } else {
                            const halfSize = this.floatBall.offsetWidth / 2;
                            const maxX = window.innerWidth - halfSize;
                            const maxY = window.innerHeight - halfSize;
                            newX = Math.max(-halfSize, Math.min(newX, maxX));
                            newY = Math.max(-halfSize, Math.min(newY, maxY));
                        }
                        
                        this.floatBall.style.left = `${newX}px`;
                        this.floatBall.style.top = `${newY}px`;
                    };
                    
                    const mouseUpHandler = () => {
                        document.removeEventListener('mousemove', mouseMoveHandler);
                        document.removeEventListener('mouseup', mouseUpHandler);
                        this.floatBall.classList.remove('dragging');
                        
                        if (this.isDragging) {
                            this.configManager.set('floatBallPosition', {
                                x: parseInt(this.floatBall.style.left),
                                y: parseInt(this.floatBall.style.top)
                            });
                        }
                        
                        setTimeout(() => {
                            this.isDragging = false;
                        }, 100);
                    };
                    
                    document.addEventListener('mousemove', mouseMoveHandler);
                    document.addEventListener('mouseup', mouseUpHandler);
                });
            }

            handleBallClick() {
                const doubleClickEnabled = this.configManager.get('doubleClickToggle');
                const currentTime = Date.now();
                
                if (doubleClickEnabled) {
                    this.clickCount++;
                    
                    if (this.clickCount === 1) {
                        // Á¨¨‰∏ÄÊ¨°ÁÇπÂáª,Á≠âÂæÖÁ¨¨‰∫åÊ¨°ÁÇπÂáª
                        this.clickTimer = setTimeout(() => {
                            // Ë∂ÖÊó∂,Âè™ÊòØÂçïÂáª,ÊâìÂºÄËÆæÁΩÆÈù¢Êùø
                            this.togglePanel();
                            this.clickCount = 0;
                        }, 300);
                    } else if (this.clickCount === 2) {
                        // Á¨¨‰∫åÊ¨°ÁÇπÂáª,ÊòØÂèåÂáª
                        clearTimeout(this.clickTimer);
                        this.clickCount = 0;
                        
                        // ÊâßË°åÂèåÂáªÂºÄÂÖ≥ÁøªËØë
                        const enabled = this.configManager.get('enabled');
                        if (!enabled) {
                            // ÂΩìÂâçÊú™ÂêØÁî®,ÂºÄÂêØÁøªËØë(ÊâßË°åÁ´ãÂç≥ÁøªËØë)
                            this.configManager.set('enabled', true);
                            this.translateManager.toggle(true);
                            const targetLang = this.configManager.get('targetLanguage');
                            this.translateManager.changeLanguage(targetLang);
                            this.updateUI();
                            this.toast.show('‚úÖ ÁøªËØëÂ∑≤ÂºÄÂêØ');
                        } else {
                            // ÂΩìÂâçÂ∑≤ÂêØÁî®,ÂÖ≥Èó≠ÁøªËØë
                            this.configManager.set('enabled', false);
                            this.translateManager.toggle(false);
                            this.updateUI();
                            this.toast.show('‚ùå ÁøªËØëÂ∑≤ÂÖ≥Èó≠');
                        }
                    }
                } else {
                    // Êú™ÂêØÁî®ÂèåÂáªÂäüËÉΩ,Áõ¥Êé•ÊâìÂºÄËÆæÁΩÆÈù¢Êùø
                    this.togglePanel();
                }
            }

            bindCommonEvents() {
                // Èù¢ÊùøÂÖ≥Èó≠ÊåâÈíÆ
                document.getElementById('translate-panel-close').addEventListener('click', () => {
                    this.togglePanel();
                });

                // Á´ãÂç≥ÁøªËØëÊåâÈíÆ
                document.getElementById('translate-now-btn').addEventListener('click', () => {
                    const targetLang = this.configManager.get('targetLanguage');
                    this.translateManager.changeLanguage(targetLang);
                    this.toast.show('üöÄ Ê≠£Âú®ÁøªËØë...');
                    this.togglePanel();
                });

                // ÂêØÁî®ÁøªËØëÂºÄÂÖ≥
                document.getElementById('translate-enable').addEventListener('change', (e) => {
                    this.configManager.set('enabled', e.target.checked);
                    this.translateManager.toggle(e.target.checked);
                    this.updateUI();
                    this.toast.show(e.target.checked ? '‚úÖ ÁøªËØëÂ∑≤ÂêØÁî®' : '‚ùå ÁøªËØëÂ∑≤Á¶ÅÁî®');
                });

                // Ëá™Âä®ÁøªËØëÂºÄÂÖ≥
                document.getElementById('translate-auto').addEventListener('change', (e) => {
                    this.configManager.set('autoTranslate', e.target.checked);
                    this.toast.show(e.target.checked ? '‚úÖ Ëá™Âä®ÁøªËØëÂ∑≤ÂêØÁî®' : '‚ùå Ëá™Âä®ÁøªËØëÂ∑≤Á¶ÅÁî®');
                });

                // Êú¨Âú∞ËØ≠Ë®ÄÈÄâÊã©
                document.getElementById('translate-local-lang').addEventListener('change', (e) => {
                    this.configManager.set('localLanguage', e.target.value);
                    if (typeof translate !== 'undefined') {
                        translate.language.setLocal(e.target.value);
                    }
                    this.toast.show('‚úÖ Ê∫êËØ≠Ë®ÄÂ∑≤Êõ¥Êñ∞');
                });

                // ÁõÆÊ†áËØ≠Ë®ÄÈÄâÊã©
                document.getElementById('translate-target-lang').addEventListener('change', (e) => {
                    this.configManager.set('targetLanguage', e.target.value);
                    this.toast.show('‚úÖ ÁõÆÊ†áËØ≠Ë®ÄÂ∑≤Êõ¥Êñ∞');
                });

                // ÊòæÁ§∫ÊÇ¨ÊµÆÁêÉÂºÄÂÖ≥
                document.getElementById('translate-show-ball').addEventListener('change', (e) => {
                    this.configManager.set('showFloatBall', e.target.checked);
                    this.floatBall.style.display = e.target.checked ? 'flex' : 'none';
                    this.toast.show(e.target.checked ? '‚úÖ ÊÇ¨ÊµÆÁêÉÂ∑≤ÊòæÁ§∫' : '‚ùå ÊÇ¨ÊµÆÁêÉÂ∑≤ÈöêËóè');
                });

                // ÂÖÅËÆ∏ÊÇ¨ÊµÆÁêÉË∂ÖÂá∫ËæπÁºò
                document.getElementById('translate-allow-half').addEventListener('change', (e) => {
                    this.configManager.set('allowHalfBall', e.target.checked);
                    this.ensureInViewport();
                    this.toast.show(e.target.checked ? '‚úÖ ÂÖÅËÆ∏Ë∂ÖÂá∫ËæπÁºò' : '‚ùå Á¶ÅÊ≠¢Ë∂ÖÂá∫ËæπÁºò');
                });

                // ÂèåÂáªÂºÄÂÖ≥ÁøªËØë
                document.getElementById('translate-double-click').addEventListener('change', (e) => {
                    this.configManager.set('doubleClickToggle', e.target.checked);
                    this.toast.show(e.target.checked ? '‚úÖ ÂèåÂáªÂºÄÂÖ≥ÁøªËØëÂ∑≤ÂêØÁî®' : '‚ùå ÂèåÂáªÂºÄÂÖ≥ÁøªËØëÂ∑≤Á¶ÅÁî®');
                });

                // ÊÇ¨ÊµÆÁêÉÂ§ßÂ∞èÊªëÂùó
                const sizeSlider = document.getElementById('translate-ball-size');
                if (sizeSlider) {
                    sizeSlider.addEventListener('input', (e) => {
                        const size = parseInt(e.target.value);
                        this.configManager.set('floatBallSize', size);
                        this.floatBall.style.width = `${size}px`;
                        this.floatBall.style.height = `${size}px`;
                        e.target.nextElementSibling.textContent = `${size}px`;
                        this.ensureInViewport();
                    });
                }

                // ÊÇ¨ÊµÆÁêÉÈÄèÊòéÂ∫¶ÊªëÂùó
                const opacitySlider = document.getElementById('translate-ball-opacity');
                if (opacitySlider) {
                    opacitySlider.addEventListener('input', (e) => {
                        const opacity = parseInt(e.target.value) / 100;
                        this.configManager.set('floatBallOpacity', opacity);
                        this.floatBall.style.opacity = opacity;
                        e.target.nextElementSibling.textContent = `${e.target.value}%`;
                    });
                }

                // ÊéßÂà∂Èù¢ÊùøÂ§ßÂ∞èÊªëÂùó
                const panelSizeSlider = document.getElementById('translate-panel-size');
                if (panelSizeSlider) {
                    panelSizeSlider.addEventListener('input', (e) => {
                        const size = parseInt(e.target.value) / 100;
                        this.configManager.set('panelSize', size);
                        this.updatePanelSize();
                        e.target.nextElementSibling.textContent = `${e.target.value}%`;
                        this.ensurePanelInViewport();
                    });
                }

                // ÊéßÂà∂Èù¢ÊùøÈÄèÊòéÂ∫¶ÊªëÂùó
                const panelOpacitySlider = document.getElementById('translate-panel-opacity');
                if (panelOpacitySlider) {
                    panelOpacitySlider.addEventListener('input', (e) => {
                        const opacity = parseInt(e.target.value) / 100;
                        this.configManager.set('panelOpacity', opacity);
                        this.panel.style.opacity = opacity;
                        e.target.nextElementSibling.textContent = `${e.target.value}%`;
                    });
                }

                // ÁøªËØëÊúçÂä°ÈÄâÊã©
                document.getElementById('translate-service').addEventListener('change', (e) => {
                    this.configManager.set('translateService', e.target.value);
                    if (typeof translate !== 'undefined') {
                        translate.service.use(e.target.value);
                    }
                    
                    // ÊòæÁ§∫/ÈöêËóèËá™ÂÆö‰πâÊúçÂä°Âú∞ÂùÄËæìÂÖ•Ê°Ü
                    const customServiceGroup = document.getElementById('custom-service-group');
                    if (customServiceGroup) {
                        customServiceGroup.style.display = e.target.value === 'translate.service' ? 'block' : 'none';
                    }
                    
                    this.toast.show('‚úÖ ÁøªËØëÊúçÂä°Â∑≤Êõ¥Êñ∞');
                });

                // ‰øùÂ≠òËá™ÂÆö‰πâÊúçÂä°Âú∞ÂùÄ
                document.getElementById('save-custom-service').addEventListener('click', () => {
                    const input = document.getElementById('custom-service-urls');
                    const value = input.value.trim();
                    this.configManager.set('customServiceUrls', value);
                    
                    // Á´ãÂç≥Â∫îÁî®ËÆæÁΩÆ
                    if (value && typeof translate !== 'undefined') {
                        const urls = value.split(',').map(url => url.trim()).filter(url => url);
                        if (urls.length > 0) {
                            translate.request.api.host = urls.length === 1 ? urls[0] : urls;
                        }
                    }
                    
                    this.toast.show('‚úÖ Ëá™ÂÆö‰πâÊúçÂä°Âú∞ÂùÄÂ∑≤‰øùÂ≠ò');
                });

                // ‰øùÂ≠òÂøΩÁï•ÁöÑClass
                document.getElementById('save-ignore-class').addEventListener('click', () => {
                    const input = document.getElementById('ignore-class-input');
                    const value = input.value.trim();
                    this.configManager.set('ignoredClasses', value);
                    this.translateManager.applyIgnoreSettings();
                    this.toast.show('‚úÖ ÂøΩÁï•ClassËÆæÁΩÆÂ∑≤‰øùÂ≠ò');
                });

                // ‰øùÂ≠òÂøΩÁï•ÁöÑID
                document.getElementById('save-ignore-id').addEventListener('click', () => {
                    const input = document.getElementById('ignore-id-input');
                    const value = input.value.trim();
                    this.configManager.set('ignoredIds', value);
                    this.translateManager.applyIgnoreSettings();
                    this.toast.show('‚úÖ ÂøΩÁï•IDËÆæÁΩÆÂ∑≤‰øùÂ≠ò');
                });

                // ‰øùÂ≠òËá™ÂÆö‰πâÊúØËØ≠
                document.getElementById('save-custom-terms').addEventListener('click', () => {
                    const input = document.getElementById('custom-terms-input');
                    const value = input.value.trim();
                    this.configManager.set('customTerms', value);
                    this.translateManager.applyCustomTerms();
                    this.toast.show('‚úÖ Ëá™ÂÆö‰πâÊúØËØ≠Â∑≤‰øùÂ≠ò');
                });

                // Èº†Ê†áÂàíËØçÁøªËØë(‰ªÖPCÁ´Ø)
                const selectionToggle = document.getElementById('translate-selection');
                if (selectionToggle) {
                    selectionToggle.addEventListener('change', (e) => {
                        this.configManager.set('enableSelectionTranslate', e.target.checked);
                        if (e.target.checked) {
                            this.translateManager.startSelectionTranslate();
                            this.toast.show('‚úÖ Èº†Ê†áÂàíËØçÁøªËØëÂ∑≤ÂêØÁî®');
                        } else {
                            this.translateManager.stopSelectionTranslate();
                            this.toast.show('‚ùå Èº†Ê†áÂàíËØçÁøªËØëÂ∑≤Á¶ÅÁî®');
                        }
                    });
                }

                // Âä®ÊÄÅÂÜÖÂÆπÁõëÂê¨
                document.getElementById('translate-listener').addEventListener('change', (e) => {
                    this.configManager.set('enableListener', e.target.checked);
                    if (e.target.checked && !this.translateManager.listenerStarted) {
                        this.translateManager.startListener();
                    }
                    this.toast.show(e.target.checked ? '‚úÖ Âä®ÊÄÅÂÜÖÂÆπÁõëÂê¨Â∑≤ÂêØÁî®' : '‚ùå Âä®ÊÄÅÂÜÖÂÆπÁõëÂê¨Â∑≤Á¶ÅÁî®');
                });

                // ÁºìÂ≠ò‰ºòÂåñ
                document.getElementById('translate-cache').addEventListener('change', (e) => {
                    this.configManager.set('enableCache', e.target.checked);
                    if (typeof translate !== 'undefined' && translate.storage) {
                        if (e.target.checked) {
                            translate.storage.enable();
                        } else {
                            translate.storage.disable();
                        }
                    }
                    this.toast.show(e.target.checked ? '‚úÖ ÁºìÂ≠ò‰ºòÂåñÂ∑≤ÂêØÁî®' : '‚ùå ÁºìÂ≠ò‰ºòÂåñÂ∑≤Á¶ÅÁî®');
                });

                // ÈáçÁΩÆÊÇ¨ÊµÆÁêÉ‰ΩçÁΩÆÊåâÈíÆ
                document.getElementById('translate-reset-ball-btn').addEventListener('click', () => {
                    const defaultPosition = { x: 20, y: 100 };
                    this.floatBall.style.left = `${defaultPosition.x}px`;
                    this.floatBall.style.top = `${defaultPosition.y}px`;
                    this.configManager.set('floatBallPosition', defaultPosition);
                    this.toast.show('‚úÖ ÊÇ¨ÊµÆÁêÉ‰ΩçÁΩÆÂ∑≤ÈáçÁΩÆ');
                });

                // ÈáçÁΩÆÈù¢Êùø‰ΩçÁΩÆÊåâÈíÆ
                document.getElementById('translate-reset-panel-btn').addEventListener('click', () => {
                    this.configManager.set('panelPosition', null);
                    this.positionPanel();
                    this.toast.show('‚úÖ Èù¢Êùø‰ΩçÁΩÆÂ∑≤ÈáçÁΩÆ');
                });

                // Ê∏ÖÈô§ÁºìÂ≠òÊåâÈíÆ
                document.getElementById('translate-clear-cache').addEventListener('click', () => {
                    const cleared = this.configManager.clearCache();
                    this.toast.show(`‚úÖ Â∑≤Ê∏ÖÈô§ ${cleared} ‰∏™ÁøªËØëÁºìÂ≠òÈ°π`);
                });

                // ÈáçÁΩÆÊâÄÊúâËÆæÁΩÆÊåâÈíÆ
                document.getElementById('translate-reset-all').addEventListener('click', () => {
                    if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâËÆæÁΩÆÂêó?Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ')) {
                        this.configManager.reset();
                        this.toast.show('‚úÖ ÊâÄÊúâËÆæÁΩÆÂ∑≤ÈáçÁΩÆ,Âç≥Â∞ÜÂà∑Êñ∞È°µÈù¢...', 'success', 1500);
                        setTimeout(() => {
                            location.reload();
                        }, 1500);
                    }
                });

                // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñ
                window.addEventListener('resize', () => {
                    this.ensureInViewport();
                    this.ensurePanelInViewport();
                });

                // ÁõëÂê¨ÊñπÂêëÂèòÂåñ
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        this.ensureInViewport();
                        this.ensurePanelInViewport();
                        this.updatePanelSize();
                    }, 300);
                });
            }

            updateUI() {
                const enabled = this.configManager.get('enabled');
                const enableCheckbox = document.getElementById('translate-enable');
                if (enableCheckbox) {
                    enableCheckbox.checked = enabled;
                }
            }

            togglePanel() {
                if (this.panel.classList.contains('show')) {
                    this.panel.classList.remove('show');
                } else {
                    this.panel.classList.add('show');
                    const savedPosition = this.configManager.get('panelPosition');
                    if (!savedPosition) {
                        this.positionPanel();
                    } else {
                        this.ensurePanelInViewport();
                    }
                }
            }

            positionPanel() {
                const mobile = isMobile();
                
                if (mobile) {
                    // ÁßªÂä®Á´ØÂ±Ö‰∏≠ÊòæÁ§∫
                    const panelWidth = this.panel.offsetWidth;
                    const panelHeight = this.panel.offsetHeight;
                    
                    const left = (window.innerWidth - panelWidth) / 2;
                    const top = (window.innerHeight - panelHeight) / 2;
                    
                    this.panel.style.left = `${left}px`;
                    this.panel.style.top = `${top}px`;
                } else {
                    // PCÁ´ØÊ†πÊçÆÊÇ¨ÊµÆÁêÉ‰ΩçÁΩÆÂÆö‰Ωç
                    const ballRect = this.floatBall.getBoundingClientRect();
                    const panelWidth = this.panel.offsetWidth;
                    const panelHeight = this.panel.offsetHeight;
                    
                    let left = ballRect.right + 10;
                    let top = ballRect.top;
                    
                    if (left + panelWidth > window.innerWidth) {
                        left = ballRect.left - panelWidth - 10;
                    }
                    
                    if (left < 0) {
                        left = (window.innerWidth - panelWidth) / 2;
                    }
                    
                    if (top < 10) {
                        top = 10;
                    }
                    
                    if (top + panelHeight > window.innerHeight - 10) {
                        top = window.innerHeight - panelHeight - 10;
                    }
                    
                    this.panel.style.left = `${left}px`;
                    this.panel.style.top = `${top}px`;
                }
            }

            ensureInViewport() {
                const position = this.configManager.get('floatBallPosition');
                const size = this.configManager.get('floatBallSize');
                const allowHalf = this.configManager.get('allowHalfBall');
                
                let x = position.x;
                let y = position.y;
                
                if (allowHalf) {
                    const halfSize = size / 2;
                    const maxX = window.innerWidth - halfSize;
                    const maxY = window.innerHeight - halfSize;
                    x = Math.max(-halfSize, Math.min(x, maxX));
                    y = Math.max(-halfSize, Math.min(y, maxY));
                } else {
                    const maxX = window.innerWidth - size;
                    const maxY = window.innerHeight - size;
                    x = Math.max(0, Math.min(x, maxX));
                    y = Math.max(0, Math.min(y, maxY));
                }
                
                this.floatBall.style.left = `${x}px`;
                this.floatBall.style.top = `${y}px`;
                
                if (x !== position.x || y !== position.y) {
                    this.configManager.set('floatBallPosition', { x, y });
                }
            }

            ensurePanelInViewport() {
                if (!this.panel.classList.contains('show')) return;
                
                const position = this.configManager.get('panelPosition');
                if (!position) return;
                
                const panelWidth = this.panel.offsetWidth;
                const panelHeight = this.panel.offsetHeight;
                
                let x = position.x;
                let y = position.y;
                
                const maxX = window.innerWidth - panelWidth;
                const maxY = window.innerHeight - panelHeight;
                
                x = Math.max(0, Math.min(x, maxX));
                y = Math.max(0, Math.min(y, maxY));
                
                this.panel.style.left = `${x}px`;
                this.panel.style.top = `${y}px`;
                
                if (x !== position.x || y !== position.y) {
                    this.configManager.set('panelPosition', { x, y });
                }
            }
        }

        // Â∑•ÂÖ∑ÂáΩÊï∞
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                || window.innerWidth <= 768;
        }

        function isDarkMode() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }

        // ÂàùÂßãÂåñ
        async function init() {
            // Á≠âÂæÖDOMÂä†ËΩΩ
            if (document.readyState === 'loading') {
                await new Promise(resolve => {
                    document.addEventListener('DOMContentLoaded', resolve);
                });
            }

            try {
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤Âä†ËΩΩtranslate.js
                if (typeof translate === 'undefined') {
                    console.error('translate.jsÊú™Âä†ËΩΩ,ËØ∑Ê£ÄÊü•@requireÈÖçÁΩÆ');
                    return;
                }
                
                // ÂàùÂßãÂåñÁªÑ‰ª∂
                const configManager = new ConfigManager();
                const translateManager = new TranslateManager(configManager);
                const uiManager = new UIManager(configManager, translateManager);

                // Ê≥®ÂÜåËèúÂçïÂëΩ‰ª§
                GM_registerMenuCommand('ÊâìÂºÄÁøªËØëËÆæÁΩÆ', () => {
                    uiManager.togglePanel();
                });

                // ÂÖ®Â±ÄÂØπË±°
                window.translateHelper = {
                    config: configManager,
                    translate: translateManager,
                    ui: uiManager
                };

                console.log('Êô∫ËÉΩÁøªËØëÂä©ÊâãÂ∑≤Âä†ËΩΩÂÆåÊàê');
                console.log('‰ΩøÁî®ËØ¥Êòé:');
                console.log('- ÂçïÂáªÊÇ¨ÊµÆÁêÉÊâìÂºÄËÆæÁΩÆÈù¢Êùø');
                console.log('- ÊãñÊãΩÊÇ¨ÊµÆÁêÉË∞ÉÊï¥‰ΩçÁΩÆ');
                console.log('- ÊîØÊåÅ100+ÁßçËØ≠Ë®Ä‰∫íËØë');
                console.log('- ÂèØÈÄöËøáwindow.translateHelperËÆøÈóÆAPI');
            } catch (error) {
                console.error('ÁøªËØëËÑöÊú¨ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        // Âª∂ËøüÂàùÂßãÂåñ‰∏ªÂäüËÉΩ,Á°Æ‰øùÊÇ¨ÊµÆÁêÉÂ∑≤ÊòæÁ§∫
        setTimeout(init, 100);
    })();
})();
